<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Step 4: Variable harmonization | 07 About the SAE App</title>
  <meta name="description" content="This eBook provides an introduction to the UNFPA small area estimation tools" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Step 4: Variable harmonization | 07 About the SAE App" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This eBook provides an introduction to the UNFPA small area estimation tools" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Step 4: Variable harmonization | 07 About the SAE App" />
  
  <meta name="twitter:description" content="This eBook provides an introduction to the UNFPA small area estimation tools" />
  

<meta name="author" content="Tom Bird" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="step-5-create-harmonized-data-files.html"/>
<link rel="next" href="appendix-user-defined-r-functions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Small Area Estimation Tools</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>II Harmonization</b></span></li>
<li class="chapter" data-level="2" data-path="harmonization.html"><a href="harmonization.html"><i class="fa fa-check"></i><b>2</b> Harmonization</a></li>
<li class="chapter" data-level="3" data-path="step-1-download-data.html"><a href="step-1-download-data.html"><i class="fa fa-check"></i><b>3</b> Step 1: Download data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="step-1-download-data.html"><a href="step-1-download-data.html#step-1a-ipums-data-and-shapefiles"><i class="fa fa-check"></i><b>3.1</b> Step 1A: IPUMS data and shapefiles</a></li>
<li class="chapter" data-level="3.2" data-path="step-1-download-data.html"><a href="step-1-download-data.html#step-1b-dhs-data-and-shapefiles"><i class="fa fa-check"></i><b>3.2</b> Step 1B: DHS data and shapefiles</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="step-2-sae-preliminaries.html"><a href="step-2-sae-preliminaries.html"><i class="fa fa-check"></i><b>4</b> Step 2: SAE preliminaries</a>
<ul>
<li class="chapter" data-level="4.1" data-path="step-2-sae-preliminaries.html"><a href="step-2-sae-preliminaries.html#step-2a-identify-dhs-indicators-of-interest"><i class="fa fa-check"></i><b>4.1</b> Step 2A: Identify DHS indicators of interest</a></li>
<li class="chapter" data-level="4.2" data-path="step-2-sae-preliminaries.html"><a href="step-2-sae-preliminaries.html#step-2b-identify-variables-to-harmonize"><i class="fa fa-check"></i><b>4.2</b> Step 2B: Identify variables to harmonize</a></li>
<li class="chapter" data-level="4.3" data-path="step-2-sae-preliminaries.html"><a href="step-2-sae-preliminaries.html#step-2c-determine-target-population"><i class="fa fa-check"></i><b>4.3</b> Step 2C: Determine target population</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="step-3-data-preparation.html"><a href="step-3-data-preparation.html"><i class="fa fa-check"></i><b>5</b> Step 3: Data preparation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="step-3-data-preparation.html"><a href="step-3-data-preparation.html#step-3a-packages-and-user-defined-functions"><i class="fa fa-check"></i><b>5.1</b> Step 3A: Packages and user-defined functions</a></li>
<li class="chapter" data-level="5.2" data-path="step-3-data-preparation.html"><a href="step-3-data-preparation.html#step-3b-ipums-data-preparation"><i class="fa fa-check"></i><b>5.2</b> Step 3B: IPUMS data preparation</a></li>
<li class="chapter" data-level="5.3" data-path="step-3-data-preparation.html"><a href="step-3-data-preparation.html#step-3c-dhs-data-preparation"><i class="fa fa-check"></i><b>5.3</b> Step 3C: DHS data preparation</a></li>
<li class="chapter" data-level="5.4" data-path="step-3-data-preparation.html"><a href="step-3-data-preparation.html#step-3d-create-supporting-files"><i class="fa fa-check"></i><b>5.4</b> Step 3D: Create supporting files</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="step-4-variable-harmonization.html"><a href="step-4-variable-harmonization.html"><i class="fa fa-check"></i><b>6</b> Step 4: Variable harmonization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="step-4-variable-harmonization.html"><a href="step-4-variable-harmonization.html#step-4a-category-alignment"><i class="fa fa-check"></i><b>6.1</b> Step 4A: Category alignment</a></li>
<li class="chapter" data-level="6.2" data-path="step-4-variable-harmonization.html"><a href="step-4-variable-harmonization.html#step-4b-create-harmonized-ipums-and-dhs-variables"><i class="fa fa-check"></i><b>6.2</b> Step 4B: Create harmonized IPUMS and DHS variables</a></li>
<li class="chapter" data-level="6.3" data-path="step-4-variable-harmonization.html"><a href="step-4-variable-harmonization.html#step-4c-write-harmonization-output-to-excel"><i class="fa fa-check"></i><b>6.3</b> Step 4C: Write harmonization output to Excel</a></li>
<li class="chapter" data-level="6.4" data-path="step-4-variable-harmonization.html"><a href="step-4-variable-harmonization.html#step-4d-miscellaneous-notes"><i class="fa fa-check"></i><b>6.4</b> Step 4D: Miscellaneous notes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="step-5-create-harmonized-data-files.html"><a href="step-5-create-harmonized-data-files.html"><i class="fa fa-check"></i><b>7</b> Step 5: Create harmonized data files</a>
<ul>
<li class="chapter" data-level="7.1" data-path="step-5-create-harmonized-data-files.html"><a href="step-5-create-harmonized-data-files.html#step-5a-create-harmonized-ipums-data-set"><i class="fa fa-check"></i><b>7.1</b> Step 5A: Create harmonized IPUMS data set</a></li>
<li class="chapter" data-level="7.2" data-path="step-5-create-harmonized-data-files.html"><a href="step-5-create-harmonized-data-files.html#step-5b-create-harmonized-dhs-data-set"><i class="fa fa-check"></i><b>7.2</b> Step 5B: Create harmonized DHS data set</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="step-4-variable-harmonization-1.html"><a href="step-4-variable-harmonization-1.html"><i class="fa fa-check"></i><b>8</b> Step 4: Variable harmonization</a>
<ul>
<li class="chapter" data-level="8.1" data-path="step-4-variable-harmonization-1.html"><a href="step-4-variable-harmonization-1.html#step-4a-category-alignment-1"><i class="fa fa-check"></i><b>8.1</b> Step 4A: Category alignment</a></li>
<li class="chapter" data-level="8.2" data-path="step-4-variable-harmonization-1.html"><a href="step-4-variable-harmonization-1.html#step-4b-create-harmonized-ipums-and-dhs-variables-1"><i class="fa fa-check"></i><b>8.2</b> Step 4B: Create harmonized IPUMS and DHS variables</a></li>
<li class="chapter" data-level="8.3" data-path="step-4-variable-harmonization-1.html"><a href="step-4-variable-harmonization-1.html#step-4c-write-harmonization-output-to-excel-1"><i class="fa fa-check"></i><b>8.3</b> Step 4C: Write harmonization output to Excel</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="appendix-user-defined-r-functions.html"><a href="appendix-user-defined-r-functions.html"><i class="fa fa-check"></i><b>9</b> Appendix: User-defined R functions</a>
<ul>
<li class="chapter" data-level="9.1" data-path="appendix-user-defined-r-functions.html"><a href="appendix-user-defined-r-functions.html#compare_categories"><i class="fa fa-check"></i><b>9.1</b> compare_categories</a></li>
<li class="chapter" data-level="9.2" data-path="appendix-user-defined-r-functions.html"><a href="appendix-user-defined-r-functions.html#new_var_label"><i class="fa fa-check"></i><b>9.2</b> new_var_label</a></li>
<li class="chapter" data-level="9.3" data-path="appendix-user-defined-r-functions.html"><a href="appendix-user-defined-r-functions.html#write_ipums_output"><i class="fa fa-check"></i><b>9.3</b> write_ipums_output</a></li>
<li class="chapter" data-level="9.4" data-path="appendix-user-defined-r-functions.html"><a href="appendix-user-defined-r-functions.html#write_dhs_output"><i class="fa fa-check"></i><b>9.4</b> write_dhs_output</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="about-the-application.html"><a href="about-the-application.html"><i class="fa fa-check"></i><b>10</b> About the Application</a>
<ul>
<li class="chapter" data-level="10.1" data-path="about-the-application.html"><a href="about-the-application.html#how-to-navigate-the-application"><i class="fa fa-check"></i><b>10.1</b> How to navigate the application</a></li>
<li class="chapter" data-level="10.2" data-path="about-the-application.html"><a href="about-the-application.html#landing-page"><i class="fa fa-check"></i><b>10.2</b> Landing Page</a></li>
</ul></li>
<li class="part"><span><b>III SAE Application</b></span></li>
<li class="chapter" data-level="11" data-path="selecting-data.html"><a href="selecting-data.html"><i class="fa fa-check"></i><b>11</b> Selecting Data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="selecting-data.html"><a href="selecting-data.html#survey-tab"><i class="fa fa-check"></i><b>11.1</b> Survey tab</a></li>
<li class="chapter" data-level="11.2" data-path="selecting-data.html"><a href="selecting-data.html#census"><i class="fa fa-check"></i><b>11.2</b> Census</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="compare-data.html"><a href="compare-data.html"><i class="fa fa-check"></i><b>12</b> Compare Data</a>
<ul>
<li class="chapter" data-level="12.1" data-path="compare-data.html"><a href="compare-data.html#correlations"><i class="fa fa-check"></i><b>12.1</b> Correlations</a></li>
<li class="chapter" data-level="12.2" data-path="compare-data.html"><a href="compare-data.html#distributions."><i class="fa fa-check"></i><b>12.2</b> Distributions.</a></li>
<li class="chapter" data-level="12.3" data-path="compare-data.html"><a href="compare-data.html#spatial"><i class="fa fa-check"></i><b>12.3</b> Spatial</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="model-setup.html"><a href="model-setup.html"><i class="fa fa-check"></i><b>13</b> Model Setup</a>
<ul>
<li class="chapter" data-level="13.1" data-path="model-setup.html"><a href="model-setup.html#build-the-model"><i class="fa fa-check"></i><b>13.1</b> Build the Model</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="model-setup.html"><a href="model-setup.html#stepwise-regression."><i class="fa fa-check"></i><b>13.1.1</b> Stepwise Regression.</a></li>
<li class="chapter" data-level="13.1.2" data-path="model-setup.html"><a href="model-setup.html#random-effects"><i class="fa fa-check"></i><b>13.1.2</b> Random effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="assessment-of-model-fit.html"><a href="assessment-of-model-fit.html"><i class="fa fa-check"></i><b>14</b> Assessment of model fit</a>
<ul>
<li class="chapter" data-level="14.1" data-path="assessment-of-model-fit.html"><a href="assessment-of-model-fit.html#assessment"><i class="fa fa-check"></i><b>14.1</b> Assessment</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="validation.html"><a href="validation.html"><i class="fa fa-check"></i><b>15</b> Validation</a>
<ul>
<li class="chapter" data-level="15.1" data-path="validation.html"><a href="validation.html#cross-validation"><i class="fa fa-check"></i><b>15.1</b> Cross Validation</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="prediction.html"><a href="prediction.html"><i class="fa fa-check"></i><b>16</b> Prediction</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">07 About the SAE App</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="step-4-variable-harmonization-1" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Step 4: Variable harmonization<a href="step-4-variable-harmonization-1.html#step-4-variable-harmonization-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="step-4a-category-alignment-1" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Step 4A: Category alignment<a href="step-4-variable-harmonization-1.html#step-4a-category-alignment-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The easiest way to demonstrate the harmonization process is through specific examples, so we will describe the harmonization of the <code>religion</code> variable for the Sierra Leone data. It is reasonable to assume that a woman’s religion might influence her use of and/or demand for contraception, so we would like to include <code>religion</code> in our models for the three DHS indicators.</p>
<p>In Step 2B, we identified <code>V130</code> as the religion variable from the DHS sample and <code>SL2015A_RELIG</code> as the religion variable from the IPUMS sample. First, as an exploratory task, we use the user-defined function <code>compare_categories()' to run a quick weighted tabulation on these two variables. Note that we use the individual sample weights</code>V005R<code>and</code>PERWT` to weight the DHS and IPUMS samples, respectively.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="step-4-variable-harmonization-1.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_categories</span>(<span class="at">ipums_data =</span> <span class="st">&quot;sl2015_ipums&quot;</span>, <span class="at">ipums_var =</span> <span class="st">&quot;SL2015A_RELIG&quot;</span>,</span>
<span id="cb30-2"><a href="step-4-variable-harmonization-1.html#cb30-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ipums_weight =</span> <span class="st">&quot;PERWT&quot;</span>, <span class="at">dhs_data =</span> <span class="st">&quot;sl2019_dhs_ir&quot;</span>,</span>
<span id="cb30-3"><a href="step-4-variable-harmonization-1.html#cb30-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dhs_var =</span> <span class="st">&quot;V130&quot;</span>, <span class="at">dhs_weight =</span> <span class="st">&quot;V005R&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="img/manual_step_4a_wiki.png" id="id" class="class" style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>We find that <code>SL2015A_RELIG</code> has more categories than <code>V130</code>, so the main harmonization task in this particular instance will be to consolidate the categories of <code>SL2015A_RELIG</code> to match those of <code>V130</code>.</p>
<p>I suggest moving out of <code>RStudio</code> temporarily and aligning these categories in the Excel workbook <code>[Country name] Harmonization - Recodes.xlsx</code> from Step 3D. The finished product can be seen below:</p>
<div class="figure">
<img src="img/manual_step_4a.png" id="id" class="class" style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>A couple things to note:</p>
<ul>
<li>Column C contains the categories from the IPUMS variable <code>SL2015A_RELIG</code>.</li>
<li>Column E contains the categories from the DHS variable <code>V130</code>. Bahai and Traditional actually <em>are</em> categories of the DHS variable <code>V130</code>, but they do not show up in the weighted frequency table above because zero cases were recorded in each of them.</li>
<li>Column B contains the harmonized variable labels, which were determined during this process of category alignment. Column A contains an arbitrary numbering of these harmonized variable labels.</li>
</ul>
<p>Harmonizing <code>SL2015A_RELIG</code> and <code>V130</code> is relatively straightforward. The six Christian denominations in <code>SL2015A_RELIG</code> can be matched with the single Christian category in <code>V130</code>. In both variables, there is one category for Islam, so these can be aligned next. In the weighted frequency tables above, we observe that Christianity and Islam account for close to 100% of the cases in both variables, and none of the remaining categories in either <code>SL2015A_RELIG</code> or <code>V130</code> have a significant number of cases. Therefore, it makes the most sense to combine the remaining labels into a harmonized category called “Other”.</p>
</div>
<div id="step-4b-create-harmonized-ipums-and-dhs-variables-1" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Step 4B: Create harmonized IPUMS and DHS variables<a href="step-4-variable-harmonization-1.html#step-4b-create-harmonized-ipums-and-dhs-variables-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now we will move back into <code>RStudio</code> and create the harmonized variables for both IPUMS and DHS. First, use the <code>fre()</code> function from the <code>expss</code> package to save a copy of the weighted frequency table from above:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="step-4-variable-harmonization-1.html#cb31-1" aria-hidden="true" tabindex="-1"></a>freq_RELIG <span class="ot">=</span> <span class="fu">fre</span>(sl2015_ipums<span class="sc">$</span>SL2015A_RELIG, <span class="at">weight =</span> sl2015_ipums<span class="sc">$</span>PERWT)</span></code></pre></div>
<p>Next, use the <code>factor()</code> and <code>ifelse()</code> functions to create the harmonized IPUMS variable. If you are unfamiliar with these functions, you can check out their respective help pages here (<a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/factor" class="uri">https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/factor</a>) and here (<a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/ifelse" class="uri">https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/ifelse</a>). We suggest naming the new variable <code>SL2015A_RELIGR</code>, which is just the original variable name with the letter “R” appended (“R” stands for “recode”).</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="step-4-variable-harmonization-1.html#cb32-1" aria-hidden="true" tabindex="-1"></a>sl2015_ipums<span class="sc">$</span>SL2015A_RELIGR <span class="ot">=</span> </span>
<span id="cb32-2"><a href="step-4-variable-harmonization-1.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="fu">ifelse</span>(sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Catholic&quot;</span> <span class="sc">|</span></span>
<span id="cb32-3"><a href="step-4-variable-harmonization-1.html#cb32-3" aria-hidden="true" tabindex="-1"></a>                 sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Anglican&quot;</span> <span class="sc">|</span></span>
<span id="cb32-4"><a href="step-4-variable-harmonization-1.html#cb32-4" aria-hidden="true" tabindex="-1"></a>                 sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Methodist&quot;</span> <span class="sc">|</span></span>
<span id="cb32-5"><a href="step-4-variable-harmonization-1.html#cb32-5" aria-hidden="true" tabindex="-1"></a>                 sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Seventh-day Adventists (SDA)&quot;</span> <span class="sc">|</span></span>
<span id="cb32-6"><a href="step-4-variable-harmonization-1.html#cb32-6" aria-hidden="true" tabindex="-1"></a>                 sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Pentecostal&quot;</span> <span class="sc">|</span></span>
<span id="cb32-7"><a href="step-4-variable-harmonization-1.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                 sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Other Christian&quot;</span>,</span>
<span id="cb32-8"><a href="step-4-variable-harmonization-1.html#cb32-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Christian&quot;</span>,</span>
<span id="cb32-9"><a href="step-4-variable-harmonization-1.html#cb32-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Islam&quot;</span>,</span>
<span id="cb32-10"><a href="step-4-variable-harmonization-1.html#cb32-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Islam&quot;</span>,</span>
<span id="cb32-11"><a href="step-4-variable-harmonization-1.html#cb32-11" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Bahai&quot;</span> <span class="sc">|</span></span>
<span id="cb32-12"><a href="step-4-variable-harmonization-1.html#cb32-12" aria-hidden="true" tabindex="-1"></a>                               sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Traditional&quot;</span> <span class="sc">|</span></span>
<span id="cb32-13"><a href="step-4-variable-harmonization-1.html#cb32-13" aria-hidden="true" tabindex="-1"></a>                               sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;Other&quot;</span> <span class="sc">|</span></span>
<span id="cb32-14"><a href="step-4-variable-harmonization-1.html#cb32-14" aria-hidden="true" tabindex="-1"></a>                               sl2015_ipums<span class="sc">$</span>SL2015A_RELIG <span class="sc">==</span> <span class="st">&quot;No religion&quot;</span>,</span>
<span id="cb32-15"><a href="step-4-variable-harmonization-1.html#cb32-15" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Other&quot;</span>, <span class="cn">NA</span>))),</span>
<span id="cb32-16"><a href="step-4-variable-harmonization-1.html#cb32-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Christian&quot;</span>, <span class="st">&quot;Islam&quot;</span>, <span class="st">&quot;Other&quot;</span>))</span></code></pre></div>
<p>The general idea behind these lines of code is as follows: If an individual is labeled as “Catholic”, “Anglican”, “Methodist”, “Seventh-day Adventists (SDA)”, “Pentecostal”, and “Other Christian” in the original variable, assign them to a category called “Christian” in the harmonized variable. If they are in the “Islam” category in the original variable, assign them to a category called “Christian” in the harmonized variable. If they are assigned to “Bahai”, “Traditional”, “Other”, or “No religion” in the original variable, assign them to “Other” in the harmonized variable. If any individuals are not covered by these three rules, mark them as missing (<code>NA</code>). (Note that no cases should be missing in the harmonized variable — if you notice any <code>NA</code> cases when tabulating the harmonized variable, you should go back and fix this issue.)</p>
<p>Next, use the user-defined function <code>new_var_label()</code> to assign a variable label to <code>SL2015A_RELIGR</code>. We suggest using a standard convention variable label where you simply append “(recode)” to the original variable label:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="step-4-variable-harmonization-1.html#cb33-1" aria-hidden="true" tabindex="-1"></a>sl2015_ipums <span class="ot">=</span> <span class="fu">new_var_label</span>(sl2015_ipums, <span class="st">&quot;Religion (recode)&quot;</span>)</span></code></pre></div>
<p>Finally, check your work by generating a weighted frequency table of the harmonized IPUMS variable:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="step-4-variable-harmonization-1.html#cb34-1" aria-hidden="true" tabindex="-1"></a>freq_RELIGR <span class="ot">=</span> <span class="fu">fre</span>(sl2015_ipums<span class="sc">$</span>SL2015A_RELIGR, <span class="at">weight =</span> sl2015_ipums<span class="sc">$</span>PERWT)</span>
<span id="cb34-2"><a href="step-4-variable-harmonization-1.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(freq_RELIGR[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">4</span>)])</span></code></pre></div>
<div class="figure">
<img src="img/manual_step_4b_wiki_1.png" id="id" class="class" style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
<p>We have successfully created the harmonized IPUMS variable for <code>religion</code>, and we can basically apply the same procedures to create the harmonized DHS variable. First, we save a copy of the weighted frequency table:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="step-4-variable-harmonization-1.html#cb35-1" aria-hidden="true" tabindex="-1"></a>V130_freq <span class="ot">=</span> <span class="fu">fre</span>(sl2019_dhs_ir<span class="sc">$</span>V130, <span class="at">weight =</span> sl2019_dhs_ir<span class="sc">$</span>V005R, <span class="at">drop_unused_labels =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Next, we use <code>factor()</code> and <code>ifelse()</code> to create the harmonized variable, which we name <code>V130R</code>. We also add a variable label for <code>V130R</code>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="step-4-variable-harmonization-1.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create harmonized DHS variable</span></span>
<span id="cb36-2"><a href="step-4-variable-harmonization-1.html#cb36-2" aria-hidden="true" tabindex="-1"></a>sl2019_dhs_ir<span class="sc">$</span>V130R <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(sl2019_dhs_ir<span class="sc">$</span>V130 <span class="sc">==</span> <span class="st">&quot;Christian&quot;</span>,</span>
<span id="cb36-3"><a href="step-4-variable-harmonization-1.html#cb36-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Christian&quot;</span>,</span>
<span id="cb36-4"><a href="step-4-variable-harmonization-1.html#cb36-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(sl2019_dhs_ir<span class="sc">$</span>V130 <span class="sc">==</span> <span class="st">&quot;Islam&quot;</span>,</span>
<span id="cb36-5"><a href="step-4-variable-harmonization-1.html#cb36-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;Islam&quot;</span>,</span>
<span id="cb36-6"><a href="step-4-variable-harmonization-1.html#cb36-6" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">ifelse</span>(sl2019_dhs_ir<span class="sc">$</span>V130 <span class="sc">==</span> <span class="st">&quot;Bahai&quot;</span> <span class="sc">|</span></span>
<span id="cb36-7"><a href="step-4-variable-harmonization-1.html#cb36-7" aria-hidden="true" tabindex="-1"></a>                                                    sl2019_dhs_ir<span class="sc">$</span>V130 <span class="sc">==</span> <span class="st">&quot;Traditional&quot;</span> <span class="sc">|</span></span>
<span id="cb36-8"><a href="step-4-variable-harmonization-1.html#cb36-8" aria-hidden="true" tabindex="-1"></a>                                                    sl2019_dhs_ir<span class="sc">$</span>V130 <span class="sc">==</span> <span class="st">&quot;Other&quot;</span> <span class="sc">|</span></span>
<span id="cb36-9"><a href="step-4-variable-harmonization-1.html#cb36-9" aria-hidden="true" tabindex="-1"></a>                                                    sl2019_dhs_ir<span class="sc">$</span>V130 <span class="sc">==</span> <span class="st">&quot;None&quot;</span>,</span>
<span id="cb36-10"><a href="step-4-variable-harmonization-1.html#cb36-10" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">&quot;Other&quot;</span>, <span class="cn">NA</span>))),</span>
<span id="cb36-11"><a href="step-4-variable-harmonization-1.html#cb36-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Christian&quot;</span>, <span class="st">&quot;Islam&quot;</span>, <span class="st">&quot;Other&quot;</span>))</span>
<span id="cb36-12"><a href="step-4-variable-harmonization-1.html#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="step-4-variable-harmonization-1.html#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add variable label</span></span>
<span id="cb36-14"><a href="step-4-variable-harmonization-1.html#cb36-14" aria-hidden="true" tabindex="-1"></a>sl2019_dhs_ir <span class="ot">=</span> <span class="fu">new_var_label</span>(sl2019_dhs_ir, <span class="st">&quot;Religion (recode)&quot;</span>)</span></code></pre></div>
<p>Finally, we generate a weighted frequency table for the harmonized DHS variable:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="step-4-variable-harmonization-1.html#cb37-1" aria-hidden="true" tabindex="-1"></a>V130R_freq <span class="ot">=</span> <span class="fu">frequency</span>(sl2019_dhs_ir<span class="sc">$</span>V130R, <span class="at">weight =</span> sl2019_dhs_ir<span class="sc">$</span>V005R, <span class="at">drop_unused_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-2"><a href="step-4-variable-harmonization-1.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(V130R_freq[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">4</span>)])</span></code></pre></div>
<div class="figure">
<img src="img/manual_step_4b_wiki_2.png" id="id" class="class" style="width:70.0%;height:70.0%" alt="" />
<p class="caption">Harmonization flowchart</p>
</div>
</div>
<div id="step-4c-write-harmonization-output-to-excel-1" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Step 4C: Write harmonization output to Excel<a href="step-4-variable-harmonization-1.html#step-4c-write-harmonization-output-to-excel-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we have created the harmonized variables for both the IPUMS data and the DHS data, we can organize our work in the Excel workbook <code>[Country name] Harmonization - Output.xlsx</code> that you created in Step 3D. Use the <code>addWorksheet()</code> function from the <code>openxlsx</code> package to create a new sheet called “Religion” within your workbook:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="step-4-variable-harmonization-1.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(sl_harmonization_output, <span class="st">&quot;Religion&quot;</span>)</span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="step-5-create-harmonized-data-files.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-user-defined-r-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/06-Functions.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
